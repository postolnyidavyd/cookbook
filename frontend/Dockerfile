# Базовий образ з Node.js для збірки фронтенд додатку
# build-stage - етап збірки фронтенд додатку, який використовує легкий образ Node.js на базі Alpine Linux
# воно працює як тимчасовий контейнер для створення оптимізованої версії фронтенд додатку
FROM node:24-alpine as build-stage

# Створюєм робочу директорію для фронтенд додатку
WORKDIR /app
# Копіюєм package.json та package-lock.json для встановлення залежностей
COPY package*.json ./
# Встановлюєм залежності
RUN npm install
# Копіюєм увесь код фронтенд додатку в робочу директорію контейнера
COPY . .

# Створюємо змінну оточення для API URL, яка передається під час збірки
ARG VITE_API_URL
# Встановлюєм змінну оточення для використання під час збірки
ENV VITE_API_URL=$VITE_API_URL

# Збираєм фронтенд додаток для продакшену
RUN npm run build

# production-stage - етап для запуску оптимізованого фронтенд додатку
# Використовуємо легкий образ Nginx( це веб-сервер заточений для швидкої доставки статичних файлів,
#на відміну від серверах на ноді, займає менше ресурсів та простіший в налаштуванні для нашої задачі)
# на базі Alpine розгортання зібраного фронтенд додатку
FROM nginx:alpine as production-stage

# Копіюєм зібрані статичні файли з етапу збірки в директорію Nginx для обслуговування
# usr/share/nginx/html - це стандартна директорія, де зберігаються статичні файли
COPY --from=build-stage /app/dist /usr/share/nginx/html

# Копіюємо файл налаштування Nginx для нашого додатку
COPY nginx.conf /etc/nginx/nginx.conf

# Відкриваєм порт 80, порт 80 тому що це стандартний порт для HTTP трафіку
EXPOSE 80

# Запускаємо Nginx
# nginx - це команда для запуску веб-сервера Nginx
# -g - параметр для передачі глобальних директив
# "daemon off;" - директива, яка вказує Nginx працювати у передньому плані,
# що необхідно для роботи контенера, оскільки контейнери припиняють роботу, коли основний процес завершується
CMD ["nginx", "-g", "daemon off;"]